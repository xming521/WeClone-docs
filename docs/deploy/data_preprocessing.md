# æ•°æ®é¢„å¤„ç†

åŸå§‹çš„èŠå¤©è®°å½•éœ€è¦ç»è¿‡é¢„å¤„ç†æ‰èƒ½ç”¨äºæ¨¡å‹è®­ç»ƒ
é¢„å¤„ç†è¿‡ç¨‹ä¼šä½¿ç”¨Microsoft Presidioè¿›è¡ŒPIIï¼ˆä¸ªäººèº«ä»½ä¿¡æ¯ï¼‰æ•°æ®çš„è¿‡æ»¤ã€‚

* **é»˜è®¤è¿‡æ»¤ï¼š** é»˜è®¤ä¼šå»é™¤æ•°æ®ä¸­çš„`ç”µè¯å·ç ã€ç”µå­é‚®ä»¶åœ°å€ã€ä¿¡ç”¨å¡å·ç ã€IPåœ°å€ã€åœ°ç†ä½ç½®åç§°ã€å›½é™…é“¶è¡Œè´¦æˆ·å·ç ã€åŠ å¯†è´§å¸é’±åŒ…åœ°å€ã€å¹´é¾„ä¿¡æ¯ã€é€šç”¨èº«ä»½è¯å·ç `ç­‰PII,ä½†æ˜¯ä¸èƒ½ä¿è¯100%è¯†åˆ«ã€‚
* **è‡ªå®šä¹‰è¿‡æ»¤ï¼š** é¡¹ç›®æä¾›äº†ä¸€ä¸ªç¦ç”¨è¯è¯åº“å‚æ•°`blocked_words`ã€‚ä½ å¯ä»¥å‘å…¶ä¸­æ·»åŠ ä¸å¸Œæœ›å‡ºç°åœ¨è®­ç»ƒæ•°æ®ä¸­çš„è¯å¥ï¼ˆåŒ…å«ç¦ç”¨è¯çš„æ•´å¥ä¼šè¢«è¿‡æ»¤æ‰ï¼‰ã€‚

### **æ‰§è¡Œé¢„å¤„ç†è„šæœ¬**

åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒçš„å‘½ä»¤è¡Œä¸­ï¼Œè¿›å…¥ WeClone é¡¹ç›®æ ¹ç›®å½•ï¼Œè¿è¡Œï¼š
```bash
weclone-cli make-dataset  
```
### ç›¸å…³å‚æ•°   
ğŸ“Œ **èŠå¤©ä¹ æƒ¯**ï¼šå¯ä»¥æ ¹æ®è‡ªå·±çš„å›å¤æ¶ˆæ¯é¢‘ç‡ä¿®æ”¹ `single_combine_time_window` å’Œ `qa_match_time_window` å‚æ•°ã€‚ç›®å‰æ”¯æŒæ—¶é—´çª—å£ç­–ç•¥ï¼Œæ ¹æ® `single_combine_time_window` å‚æ•°å°†å•äººè¿ç»­æ¶ˆæ¯é€šè¿‡ç¬¦å·ï¼ˆä¸­æ–‡ä¸º`ï¼Œ`ï¼Œè‹±æ–‡ä¸º`|`ï¼‰è¿æ¥åˆå¹¶ä¸ºä¸€å¥ï¼Œæ ¹æ® `qa_match_time_window` å‚æ•°åŒ¹é…é—®ç­”å¯¹ã€‚

ğŸ“Œ **è®­ç»ƒå¤šæ¨¡æ€å¤§æ¨¡å‹**ï¼šåœ¨`include_type`ä¸­æ·»åŠ `images`å¯ç”¨ï¼Œå¹¶é€šè¿‡`image_max_pixels`å’Œ`max_image_num`å‚æ•°æ§åˆ¶å›¾ç‰‡æ•°é‡å’Œå¤§å°ï¼Œä»¥å‡å°‘æ˜¾å­˜å ç”¨ã€‚

ğŸ“Œ **Image to Text**ï¼šåœ¨`include_type`ä¸­æ·»åŠ `images`å¹¶é…ç½® `vision_api` å‚æ•°ï¼Œå°†ä½¿ç”¨å¤–éƒ¨å¤šæ¨¡æ€æ¨¡å‹å°†å›¾ç‰‡è½¬ä¸ºæ–‡æœ¬ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ•°æ®é›†**ä»ç”¨äºè®­ç»ƒçº¯æ–‡æœ¬è¯­è¨€æ¨¡å‹**ã€‚

ğŸ“Œ **æ•°æ®æ¸…æ´—**ï¼šå¯ä»¥å¯ç”¨`clean_dataset`ä¸­çš„`enable_clean`é€‰é¡¹ï¼Œå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œä»¥è¾¾åˆ°æ›´å¥½æ•ˆæœï¼ˆå¤šæ¨¡æ€æ•°æ®æš‚ä¸æ”¯æŒï¼‰ã€‚å½“å‰æ”¯æŒä½¿ç”¨ `llm judge` å¯¹èŠå¤©è®°å½•è¿›è¡Œæ‰“åˆ†ï¼Œæä¾› **vllm ç¦»çº¿æ¨ç†** å’Œ **API åœ¨çº¿æ¨ç†** ä¸¤ç§æ–¹å¼ã€‚é»˜è®¤ç¦»çº¿æ¨ç†ï¼Œå¯é€šè¿‡å°† `settings.jsonc` æ–‡ä»¶ä¸­çš„ `"online_llm_clear": false` ä¿®æ”¹ä¸º `true` æ¥å¯ç”¨ API åœ¨çº¿æ¨ç†æ¨¡å¼ï¼Œå¹¶é…ç½®ç›¸åº”çš„ `base_url`ã€`llm_api_key`ã€`model_name` ç­‰å‚æ•°ã€‚æ‰€æœ‰å…¼å®¹ OpenAI æ¥å£çš„æ¨¡å‹å‡å¯æ¥å…¥ã€‚

  
## ğŸ’¡ ä½¿ç”¨ vLLM æ—¶çš„æ³¨æ„äº‹é¡¹

å¦‚æœä½ é€‰æ‹©ä½¿ç”¨**vllmè¿›è¡Œç¦»çº¿æ¨ç†**ï¼Œä¸”æ˜¾å­˜æœ‰é™ï¼Œéœ€è¦å¯ç”¨**vLLMçš„`bitsandbytes`é‡åŒ–åŠ è½½**ï¼Œå¦åˆ™è¿™ä¸€æ­¥ä¹Ÿå¯èƒ½ä¼šçˆ†æ˜¾å­˜ã€‚è¿›ä¸€æ­¥è°ƒæ•´ã€ä¼˜åŒ–`vllm`å‚æ•°è¯·æŸ¥è¯¢[ vLLM å¼•æ“å‚æ•° ](https://docs.vllm.com.cn/en/latest/serving/engine_args.html#engine-args)

é…ç½®æ–‡ä»¶vLLM å¼•æ“å‚æ•°`vllm_args`ï¼š
```json
...
"vllm_args": {
    "gpu_memory_utilization": 0.9,
    "quantization": "bitsandbytes", // æ˜¯å¦å¯ç”¨vllmçš„ bitsandbytes çš„é‡åŒ–åŠ è½½
    "load_format": "bitsandbytes"
    ...
    },
...
```
>[!TIP]
> å¦‚æœé‡åˆ°æŠ¥é”™`ImportError: Please install bitsandbytes>=0.45.3`ï¼Œå¯ä»¥å°è¯•é‡æ–°å®‰è£…`bitsandbytes`ï¼š
> ```bash
> uv pip install bitsandbytes>=0.39.0
> ```

* å¦‚æœä½ ä½¿ç”¨äº†å‹å·æ¯”è¾ƒè€çš„GPUï¼ˆä¾‹å¦‚ï¼Œè®¡ç®—èƒ½åŠ› Compute Capability ä½äº 8.0 çš„NVIDIA GPUï¼Œå¦‚Tesla T4, V100, GTX 10xx/20xxç³»åˆ—ç­‰ï¼‰å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢æŠ¥é”™ï¼š

  ```bash
  ValueError: Bfloat16 is only supported on GPUs with compute capability of at least 8.0. Your xxx GPU has compute capability xx. You can use float16 instead by explicitly setting the idtype flag in CLI, for ecample: --dtype=half.
  ```

  è¿™æ—¶å€™ä½ å¯ä»¥å°è¯•åœ¨åŸæœ¬çš„`CLI`ååŠ ä¸Š`--dtype=half`ç„¶åé‡æ–°æ‰§è¡Œï¼š

  ```bash
  weclone-cli make-dataset --dtype=half
  ```